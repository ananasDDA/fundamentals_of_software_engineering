# ПРАКТИЧЕСКАЯ РАБОТА №2

Ниже представлены UML-диаграммы в формате Mermaid, которые корректно рендерятся в GitHub. Диаграммы отражают архитектуру и поведение теоретического проекта CaseGenius (RAG-платформа для генерации управленческих кейсов).

## 1) System Component Diagram — верхнеуровневая архитектура CaseGenius

```mermaid
flowchart TB
  A[Клиент (Web/React)] --> B[API Gateway]
  B --> C[Auth Service]
  B --> D[Case Generation Service]
  B --> E[Feedback Service]

  D --> F[RAG Engine]
  F --> G[Vector DB]
  F --> H[LLM API]

  E --> H
  E --> I[Evaluation Logic]

  G --> J[Knowledge Base]
  D --> K[(PostgreSQL: User Profiles)]
  E --> K

  classDef cloud fill:#e8f5e9,stroke:#2e7d32,color:#1b5e20;
  classDef data fill:#ede7f6,stroke:#5e35b1,color:#311b92;
  class H cloud;
  class G,J,K data;
```

## 2) Domain Model (Class Diagram) — ключевые сущности

```mermaid
classDiagram
  class User {
    +UUID id
    +string email
    +string role
    +JSONB competency_profile
    +datetime created_at
  }

  class KnowledgeChunk {
    +UUID id
    +text content
    +vector embedding
    +JSONB metadata
    +UUID document_id
  }

  class CaseParameters {
    +string competency
    +string industry
    +string difficulty_level
    +UUID user_id
  }

  class GeneratedCase {
    +UUID id
    +UUID user_id
    +text case_text
    +JSONB parameters
    +JSONB context_sources
    +text feedback_text
    +datetime created_at
  }

  User "1" --o "*" GeneratedCase : создаёт
  GeneratedCase o-- CaseParameters : параметры
  KnowledgeChunk <.. GeneratedCase : источники контекста (RAG)
```

## 3) RAG Pipeline (Activity) — поток операций

```mermaid
flowchart TD
  A[Запрос генерации кейса] --> B[Вычислить эмбеддинг запроса]
  B --> C[Vector DB: similarity search k=3]
  C --> D[Сформировать промпт с контекстом]
  D --> E[LLM: сгенерировать текст кейса]
  E --> F[Сохранить кейс и источники]
  F --> G[Вернуть case_id и case_text]
```

## 4) Sequence Diagram — API сценарии

```mermaid
sequenceDiagram
  participant C as Client (Web)
  participant G as API Gateway
  participant CG as Case Generation Service
  participant R as RAG Engine
  participant V as Vector DB
  participant L as LLM API
  participant DB as PostgreSQL

  Note over C,G: POST /api/v1/generate-case
  C->>G: параметры (competency, industry, difficulty_level, user_id)
  G->>CG: валидированные параметры
  CG->>R: retrieve_context(query, filters)
  R->>V: similarity_search(embedding, k=3)
  V-->>R: релевантные чанки
  R-->>CG: контекст
  CG->>L: prompt(context + параметры)
  L-->>CG: case_text
  CG->>DB: save(case, sources, params)
  DB-->>CG: case_id
  CG-->>G: case_id, case_text, context_sources
  G-->>C: JSON ответ

  Note over C,G: POST /api/v1/submit-solution
  C->>G: case_id, user_solution, user_id
  G->>CG: получить кейс
  CG->>DB: load(case)
  DB-->>CG: case
  CG->>L: оценка/feedback prompt
  L-->>CG: feedback_text, bullets
  CG->>DB: save(feedback)
  CG-->>G: feedback
  G-->>C: JSON ответ
```

## 5) Data Model (ER) — основные таблицы

```mermaid
erDiagram
  USERS ||--o{ GENERATED_CASES : creates
  KNOWLEDGE_CHUNKS ||--o{ GENERATED_CASES : provides_context

  USERS {
    UUID id PK
    VARCHAR email
    VARCHAR role
    JSONB competency_profile
    TIMESTAMP created_at
  }

  KNOWLEDGE_CHUNKS {
    UUID id PK
    TEXT content
    VECTOR embedding
    JSONB metadata
    UUID document_id
  }

  GENERATED_CASES {
    UUID id PK
    UUID user_id FK
    TEXT case_text
    JSONB parameters
    JSONB context_sources
    TEXT feedback_text
    TIMESTAMP created_at
  }
```

---

Краткие примечания:
- Диаграммы отражают теоретическую архитектуру MVP «CaseGenius» (RAG + LLM).
- Диаграммы совместимы с рендером Mermaid на GitHub (без управляющих символов и составных инструкций на одной строке).
